"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{25703:(e,t,n)=>{n.d(t,{$g:()=>i,Wr:()=>c,ZV:()=>l,cn:()=>o,l9:()=>s});var r=n(72902),a=n(13714);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,r.$)(t))}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e>=1e9?(e/1e9).toFixed(t)+"B":e>=1e6?(e/1e6).toFixed(t)+"M":e>=1e3?(e/1e3).toFixed(t)+"K":e.toFixed(t)}function i(e){let t=Math.abs(e);return t>=1e3?e.toFixed(0):t>=100?e.toFixed(1):t>=1?e.toFixed(2):t>=.01?e.toFixed(4):t>=1e-4?e.toFixed(6):t>=1e-8?e.toFixed(8):t>0?e.toExponential(2):"0.00"}function s(e){return(e>=0?"+":"")+e.toFixed(2)+"%"}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return"".concat(e.slice(0,t),"...").concat(e.slice(-t))}},49140:(e,t,n)=>{n.d(t,{o:()=>l});var r=n(7620),a=n(81989),o=n(50773);function l(e){let{enabled:t,movementSpeed:n=15,lookSpeed:l=.002,onExit:i}=e,{camera:s,gl:c}=(0,a.C)(),u=(0,r.useRef)({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1,speedUp:!1}),d=(0,r.useRef)(new o.Euler(0,0,0,"YXZ")),h=(0,r.useRef)(!1),m=(0,r.useRef)(null);(0,r.useEffect)(()=>{t&&(d.current.setFromQuaternion(s.quaternion),m.current||(m.current={position:s.position.clone(),quaternion:s.quaternion.clone()}))},[t,s]);let x=(0,r.useCallback)(e=>{if(t)switch(["KeyW","KeyA","KeyS","KeyD","KeyQ","KeyE","Space"].includes(e.code)&&e.preventDefault(),e.code){case"KeyW":u.current.forward=!0;break;case"KeyS":u.current.backward=!0;break;case"KeyA":u.current.left=!0;break;case"KeyD":u.current.right=!0;break;case"KeyQ":u.current.down=!0;break;case"KeyE":case"Space":u.current.up=!0;break;case"ShiftLeft":case"ShiftRight":u.current.speedUp=!0;break;case"Escape":document.pointerLockElement&&document.exitPointerLock(),null==i||i()}},[t,i]),p=(0,r.useCallback)(e=>{if(t)switch(e.code){case"KeyW":u.current.forward=!1;break;case"KeyS":u.current.backward=!1;break;case"KeyA":u.current.left=!1;break;case"KeyD":u.current.right=!1;break;case"KeyQ":u.current.down=!1;break;case"KeyE":case"Space":u.current.up=!1;break;case"ShiftLeft":case"ShiftRight":u.current.speedUp=!1}},[t]),f=(0,r.useCallback)(e=>{if(!t||!h.current)return;let n=e.movementX||0,r=e.movementY||0;d.current.y-=n*l,d.current.x-=r*l,d.current.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,d.current.x)),s.quaternion.setFromEuler(d.current)},[t,s,l]),g=(0,r.useCallback)(()=>{h.current=document.pointerLockElement===c.domElement,h.current},[c.domElement,t]),w=(0,r.useCallback)(()=>{console.error("Pointer lock error - fly mode may not work properly")},[]),v=(0,r.useCallback)(()=>{t&&!h.current&&c.domElement.requestPointerLock()},[t,c.domElement]);return(0,r.useEffect)(()=>{if(!t){u.current={forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1,speedUp:!1},document.pointerLockElement===c.domElement&&document.exitPointerLock();return}return document.addEventListener("keydown",x),document.addEventListener("keyup",p),document.addEventListener("mousemove",f),document.addEventListener("pointerlockchange",g),document.addEventListener("pointerlockerror",w),c.domElement.addEventListener("click",v),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",p),document.removeEventListener("mousemove",f),document.removeEventListener("pointerlockchange",g),document.removeEventListener("pointerlockerror",w),c.domElement.removeEventListener("click",v),document.pointerLockElement===c.domElement&&document.exitPointerLock()}},[t,c.domElement,x,p,f,g,w,v]),(0,a.D)((e,r)=>{if(!t)return;let a=(u.current.speedUp?2.5*n:n)*r,l=new o.Vector3,i=new o.Vector3,c=new o.Vector3(0,1,0);s.getWorldDirection(l),i.crossVectors(l,c).normalize();let d=new o.Vector3;u.current.forward&&d.add(l.clone().multiplyScalar(a)),u.current.backward&&d.add(l.clone().multiplyScalar(-a)),u.current.left&&d.add(i.clone().multiplyScalar(-a)),u.current.right&&d.add(i.clone().multiplyScalar(a)),u.current.up&&(d.y+=a),u.current.down&&(d.y-=a),s.position.add(d)}),null}},81834:(e,t,n)=>{n.r(t),n.d(t,{Chart3D:()=>X});var r=n(54568),a=n(7620),o=n(81989),l=n(15963),i=n(97295),s=n(85821),c=n(55765),u=n(50773);function d(e){let{index:t,open:n,high:l,low:i,close:s,isUp:c,isLatest:d=!1,spacing:h=1.2,width:m=.7,depth:x=.7}=e,p=(0,a.useRef)(null),f=(0,a.useRef)(null),g=isFinite(n)?n:0,w=isFinite(s)?s:0,v=isFinite(l)?l:Math.max(g,w),b=isFinite(i)?i:Math.min(g,w),y=Math.max(.03,.2*Math.min(m,x)),j=Math.max(g,w),k=Math.min(g,w),M=Math.max(j-k,.05),C=(j+k)/2,E=v-j,N=k-b,F=E>.001?E:0,S=N>.001?N:0,L=new u.Color("#22c55e"),D=new u.Color("#ef4444"),A=c?L:D;return(0,o.D)(d?e=>{if(f.current){let t=1+.08*Math.sin(3*e.clock.elapsedTime);f.current.scale.setScalar(t)}}:()=>{}),(0,r.jsxs)("group",{position:[t*h,0,0],children:[(0,r.jsxs)("mesh",{ref:p,position:[0,C,0],children:[(0,r.jsx)("boxGeometry",{args:[m,M,x]}),(0,r.jsx)("meshStandardMaterial",{color:A,emissive:A,emissiveIntensity:.4*!!d,metalness:.4,roughness:.3})]}),F>0&&(0,r.jsxs)("mesh",{position:[0,j+F/2,0],children:[(0,r.jsx)("boxGeometry",{args:[y,F,y]}),(0,r.jsx)("meshStandardMaterial",{color:A,metalness:.3,roughness:.4})]}),S>0&&(0,r.jsxs)("mesh",{position:[0,k-S/2,0],children:[(0,r.jsx)("boxGeometry",{args:[y,S,y]}),(0,r.jsx)("meshStandardMaterial",{color:A,metalness:.3,roughness:.4})]}),d&&(0,r.jsxs)("mesh",{ref:f,position:[0,C,0],children:[(0,r.jsx)("boxGeometry",{args:[1.3*m,1.2*M,1.3*x]}),(0,r.jsx)("meshBasicMaterial",{color:A,transparent:!0,opacity:.2})]})]})}function h(e){let{index:t,height:n,isUp:a,spacing:o=1.2,width:l=.7,depth:i=.7,zOffset:s=6}=e,c=new u.Color("#22c55e"),d=new u.Color("#ef4444"),h=Math.max(n,.1);return(0,r.jsxs)("mesh",{position:[t*o,n/2,s],children:[(0,r.jsx)("boxGeometry",{args:[l,h,i]}),(0,r.jsx)("meshStandardMaterial",{color:a?c:d,transparent:!0,opacity:.6,metalness:.2,roughness:.5})]})}var m=n(60657);function x(e){let{width:t,height:n,depth:o,isDark:l=!0}=e,i=new u.Color(l?"#1a1a1a":"#e5e7eb"),s=new u.Color("#FF6B4A"),c=(0,a.useMemo)(()=>{let e=[],n=Math.ceil(t/5),r=Math.ceil(o/5);for(let n=0;n<=r;n++){let a=n/r*o-o/2;e.push([new u.Vector3(0,0,a),new u.Vector3(t,0,a)])}for(let r=0;r<=n;r++){let a=r/n*t;e.push([new u.Vector3(a,0,-o/2),new u.Vector3(a,0,o/2)])}return e},[t,o]),d=(0,a.useMemo)(()=>{let e=[],r=Math.ceil(t/5),a=Math.ceil(n/2),l=-o/2;for(let r=0;r<=a;r++){let o=r/a*n;e.push([new u.Vector3(0,o,l),new u.Vector3(t,o,l)])}for(let a=0;a<=r;a++){let o=a/r*t;e.push([new u.Vector3(o,0,l),new u.Vector3(o,n,l)])}return e},[t,n,o]),h=(0,a.useMemo)(()=>{let e=[],t=Math.ceil(o/5),r=Math.ceil(n/2);for(let t=0;t<=r;t++){let a=t/r*n;e.push([new u.Vector3(0,a,-o/2),new u.Vector3(0,a,o/2)])}for(let r=0;r<=t;r++){let a=r/t*o-o/2;e.push([new u.Vector3(0,0,a),new u.Vector3(0,n,a)])}return e},[n,o]);return(0,r.jsxs)("group",{children:[c.map((e,t)=>(0,r.jsx)(m.N,{points:e,color:i,lineWidth:.5,transparent:!0,opacity:.4},"floor-".concat(t))),d.map((e,t)=>(0,r.jsx)(m.N,{points:e,color:s,lineWidth:.5,transparent:!0,opacity:.15},"back-".concat(t))),h.map((e,t)=>(0,r.jsx)(m.N,{points:e,color:i,lineWidth:.5,transparent:!0,opacity:.2},"side-".concat(t))),(0,r.jsxs)("mesh",{position:[t/2,-.01,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("planeGeometry",{args:[t+4,o+4]}),(0,r.jsx)("meshStandardMaterial",{color:l?"#0a0a0a":"#f3f4f6",transparent:!0,opacity:.8})]})]})}var p=n(28748);function f(e){let{minPrice:t,maxPrice:n,candleCount:o,chartWidth:l,chartHeight:i,showMarketCap:s=!1,data:c=[],spacing:u=1.2,isDark:d=!0}=e,h=d?"#888":"#666",m=d?"#aaa":"#555",x=s?1e9:1,f=t*x,g=n*x,w=(0,a.useMemo)(()=>{let e=[],t=g-f;for(let n=0;n<=5;n++){let r=f+t*n/5,a=n/5*i;e.push({value:r,position:[-2,a,0]})}return e},[f,g,i]),v=(0,a.useMemo)(()=>{if(0===c.length)return[];let e=[],t=c[0].timestamp,n=(c[c.length-1].timestamp-t)/36e5,r=n<=48,a=n/24>180,o=Math.min(8,Math.max(5,Math.floor(c.length/15)));for(let t=0;t<o;t++){let n=Math.floor(t/(o-1)*(c.length-1)),l=c[n];if(!l)continue;let i=n*u;e.push({text:function(e,t,n){let r=new Date(e);if(n){let e=r.getHours(),t=r.getMinutes(),n=e%12||12;return 0===t?"".concat(n).concat(e>=12?"PM":"AM"):"".concat(n,":").concat(t.toString().padStart(2,"0"))}let a=r.toLocaleString("default",{month:"short"}),o=r.getDate();if(t){let e=r.getFullYear().toString().slice(-2);return"".concat(a," '").concat(e)}return"".concat(a," ").concat(o)}(l.timestamp,a,r),position:[i,-1.8,0]})}return e},[c,u]);return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[-.5,i/2,0],children:[(0,r.jsx)("boxGeometry",{args:[.03,i,.03]}),(0,r.jsx)("meshBasicMaterial",{color:"#FF6B4A",transparent:!0,opacity:.4})]}),w.map((e,t)=>{var n;let{value:a,position:o}=e;return(0,r.jsx)(p.E,{position:o,fontSize:.32,color:h,anchorX:"right",anchorY:"middle",children:(n=a,s?n>=1e9?"$".concat((n/1e9).toFixed(1),"B"):n>=1e6?"$".concat((n/1e6).toFixed(1),"M"):n>=1e3?"$".concat((n/1e3).toFixed(1),"K"):"$".concat(n.toFixed(0)):n>=1e3?"$".concat((n/1e3).toFixed(1),"K"):n>=1?"$".concat(n.toFixed(2)):n>=.01?"$".concat(n.toFixed(4)):n>=1e-4?"$".concat(n.toFixed(6)):"$".concat(n.toExponential(2)))},"price-".concat(t))}),(0,r.jsxs)("mesh",{position:[l/2,0,0],children:[(0,r.jsx)("boxGeometry",{args:[l,.03,.03]}),(0,r.jsx)("meshBasicMaterial",{color:"#FF6B4A",transparent:!0,opacity:.4})]}),v.map((e,t)=>{let{text:n,position:a}=e;return(0,r.jsx)(p.E,{position:[a[0],a[1],8],fontSize:.7,color:m,anchorX:"center",anchorY:"top",renderOrder:10,children:n},"date-".concat(t))}),(0,r.jsx)(p.E,{position:[-5,i/2,0],fontSize:.35,color:m,anchorX:"center",anchorY:"middle",rotation:[0,0,Math.PI/2],children:s?"Market Cap":"Price (USD)"}),(0,r.jsx)(p.E,{position:[l/2,-2.8,8],fontSize:.5,color:m,anchorX:"center",anchorY:"middle",renderOrder:10,children:"Time"})]})}var g=n(49140);let w=()=>"drawing-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),v=e=>new u.Vector3(e.x,e.y,e.z);function b(e){let{drawing:t}=e,n={x:t.startPoint.x+200*t.direction.x,y:t.startPoint.y+200*t.direction.y,z:t.startPoint.z+200*t.direction.z},o=(0,a.useMemo)(()=>[v(t.startPoint),v(n)],[t.startPoint,n]);return(0,r.jsx)(m.N,{points:o,color:t.color,lineWidth:t.lineWidth,transparent:!0,opacity:.9})}function y(e){let{drawing:t}=e,n=(0,a.useMemo)(()=>[v(t.startPoint),v(t.endPoint)],[t.startPoint,t.endPoint]);return(0,r.jsx)(m.N,{points:n,color:t.color,lineWidth:t.lineWidth,transparent:!0,opacity:.9})}function j(e){let{drawing:t}=e,n=(0,a.useMemo)(()=>[new u.Vector3(0,t.y,.1),new u.Vector3(60,t.y,.1)],[t.y]);return(0,r.jsx)(m.N,{points:n,color:t.color,lineWidth:t.lineWidth,dashed:!0,dashSize:.5,gapSize:.3,transparent:!0,opacity:.8})}function k(e){let{drawing:t}=e,n=(0,a.useMemo)(()=>[new u.Vector3(t.x,0,.1),new u.Vector3(t.x,10,.1)],[t.x]);return(0,r.jsx)(m.N,{points:n,color:t.color,lineWidth:t.lineWidth,dashed:!0,dashSize:.5,gapSize:.3,transparent:!0,opacity:.8})}function M(e){let{drawing:t}=e,n=(0,a.useMemo)(()=>{if(t.points.length<2)return null;let e=t.points.map(v);return e.length>=3?new u.CatmullRomCurve3(e,!1,"catmullrom",.5).getPoints(Math.max(50,3*e.length)):e},[t.points]);return!n||n.length<2?null:(0,r.jsx)(m.N,{points:n,color:t.color,lineWidth:t.lineWidth,transparent:!0,opacity:.9})}function C(e){let{tool:t,startPoint:n,currentPoint:a,points:o,color:l,lineWidth:i}=e;if(!t)return null;if("freehand"===t&&o.length>=2){let e=o.map(v);return(0,r.jsx)(m.N,{points:e,color:l,lineWidth:i,transparent:!0,opacity:.6})}if(!n||!a)return null;if("ray"===t){let e=a.x-n.x,t=a.y-n.y,o=Math.sqrt(e*e+t*t);if(0===o)return null;let s={x:e/o,y:t/o},c={x:n.x+200*s.x,y:n.y+200*s.y,z:n.z};return(0,r.jsx)(m.N,{points:[v(n),v(c)],color:l,lineWidth:i,transparent:!0,opacity:.6})}return"segment"===t?(0,r.jsx)(m.N,{points:[v(n),v(a)],color:l,lineWidth:i,transparent:!0,opacity:.6}):"hline"===t?(0,r.jsx)(m.N,{points:[new u.Vector3(0,a.y,.1),new u.Vector3(60,a.y,.1)],color:l,lineWidth:i,dashed:!0,dashSize:.5,gapSize:.3,transparent:!0,opacity:.5}):"vline"===t?(0,r.jsx)(m.N,{points:[new u.Vector3(a.x,0,.1),new u.Vector3(a.x,10,.1)],color:l,lineWidth:i,dashed:!0,dashSize:.5,gapSize:.3,transparent:!0,opacity:.5}):null}function E(e){let{drawings:t,activeTool:n,activeColor:l,activeLineWidth:i,onDrawingComplete:s,enabled:c,orbitControlsRef:d}=e,{gl:h}=(0,o.C)(),{screenToWorld:m,getDirection:x,clampToChart:p}=function(){let{camera:e,gl:t,size:n}=(0,o.C)(),r=(0,a.useCallback)(function(n,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=t.domElement.getBoundingClientRect(),l=(n-o.left)/o.width*2-1,i=-(2*((r-o.top)/o.height))+1,s=new u.Raycaster;s.setFromCamera(new u.Vector2(l,i),e);let c=new u.Plane(new u.Vector3(0,0,1),-a),d=new u.Vector3;return s.ray.intersectPlane(c,d)?{x:d.x,y:d.y,z:a}:null},[e,t]),l=(0,a.useCallback)((e,t)=>t.minPrice+e/10*t.priceRange,[]),i=(0,a.useCallback)((e,t)=>0===t.priceRange?5:Math.max(0,Math.min(10,(e-t.minPrice)/t.priceRange*10)),[]),s=(0,a.useCallback)((e,t)=>0===t?0:Math.round(e/(60/t)),[]),c=(0,a.useCallback)((e,t)=>0===t?0:60/t*e,[]),d=(0,a.useCallback)(e=>({x:Math.max(0,Math.min(60,e.x)),y:Math.max(0,Math.min(10,e.y)),z:e.z}),[]),h=(0,a.useCallback)((e,t)=>{let n=t.x-e.x,r=t.y-e.y,a=t.z-e.z,o=Math.sqrt(n*n+r*r+a*a);return 0===o?{x:1,y:0,z:0}:{x:n/o,y:r/o,z:a/o}},[]);return{screenToWorld:r,worldYToPrice:l,priceToWorldY:i,worldXToIndex:s,indexToWorldX:c,clampToChart:d,getDirection:h,extendRay:(0,a.useCallback)((e,t,n)=>({x:e.x+t.x*n,y:e.y+t.y*n,z:e.z+t.z*n}),[]),snapToGrid:(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return{x:Math.round(e.x/t)*t,y:Math.round(e.y/n)*n,z:e.z}},[])}}(),[f,g]=(0,a.useState)(!1),[v,E]=(0,a.useState)(null),[N,F]=(0,a.useState)(null),[S,L]=(0,a.useState)([]),D=(0,a.useRef)(!1),A=(0,a.useRef)(null);(0,a.useEffect)(()=>{(null==d?void 0:d.current)&&c&&n&&(d.current.enabled=!f)},[f,c,n,d]);let P=(0,a.useCallback)(e=>{if(!c||!n)return;e.preventDefault(),e.stopPropagation();let t=m(e.clientX,e.clientY,.1);if(!t)return;let r=p(t);return"hline"===n?void s({id:w(),type:"hline",y:r.y,color:l,lineWidth:i,createdAt:Date.now(),locked:!1}):"vline"===n?void s({id:w(),type:"vline",x:r.x,color:l,lineWidth:i,createdAt:Date.now(),locked:!1}):void(g(!0),D.current=!0,E(r),A.current=r,F(r),"freehand"===n&&L([r]))},[c,n,l,i,m,p,s]),R=(0,a.useCallback)(e=>{if(!c||!n)return;let t=m(e.clientX,e.clientY,.1);if(!t)return;let r=p(t);F(r),D.current&&"freehand"===n&&L(e=>{let t=e[e.length-1];if(t){let n=r.x-t.x,a=r.y-t.y;if(.3>Math.sqrt(n*n+a*a))return e}return[...e,r]})},[c,n,m,p]),z=(0,a.useCallback)(e=>{if(!D.current||!n)return;let t=m(e.clientX,e.clientY,.1),r=t?p(t):N;if(!A.current||!r){g(!1),D.current=!1,E(null),L([]);return}if("ray"===n){let e=x(A.current,r);s({id:w(),type:"ray",startPoint:A.current,direction:e,color:l,lineWidth:i,createdAt:Date.now(),locked:!1})}else"segment"===n?s({id:w(),type:"segment",startPoint:A.current,endPoint:r,color:l,lineWidth:i,createdAt:Date.now(),locked:!1}):"freehand"===n&&S.length>=2&&s({id:w(),type:"freehand",points:[...S,r],color:l,lineWidth:i,createdAt:Date.now(),locked:!1});g(!1),D.current=!1,E(null),A.current=null,L([])},[n,l,i,N,S,m,p,x,s]);return(0,a.useEffect)(()=>{if(!c||!n)return;let e=h.domElement;return e.addEventListener("pointerdown",P),e.addEventListener("pointermove",R),e.addEventListener("pointerup",z),e.addEventListener("pointerleave",z),()=>{e.removeEventListener("pointerdown",P),e.removeEventListener("pointermove",R),e.removeEventListener("pointerup",z),e.removeEventListener("pointerleave",z)}},[c,n,h,P,R,z]),(0,r.jsxs)("group",{children:[t.map(e=>{switch(e.type){case"ray":return(0,r.jsx)(b,{drawing:e},e.id);case"segment":return(0,r.jsx)(y,{drawing:e},e.id);case"hline":return(0,r.jsx)(j,{drawing:e},e.id);case"vline":return(0,r.jsx)(k,{drawing:e},e.id);case"freehand":return(0,r.jsx)(M,{drawing:e},e.id);default:return null}}),c&&n&&(0,r.jsx)(C,{tool:n,startPoint:v,currentPoint:N,points:S,color:l,lineWidth:i})]})}var N=n(43030),F=n(10614),S=n(24643),L=n(95022),D=n(45836),A=n(3927),P=n(2167);let R=[{type:"select",icon:(0,r.jsx)(N.A,{className:"w-4 h-4"}),label:"Select"},{type:"segment",icon:(0,r.jsx)(F.A,{className:"w-4 h-4"}),label:"Segment"},{type:"ray",icon:(0,r.jsx)(S.A,{className:"w-4 h-4"}),label:"Ray"},{type:"hline",icon:(0,r.jsx)(L.A,{className:"w-4 h-4"}),label:"H-Line"},{type:"vline",icon:(0,r.jsx)(D.A,{className:"w-4 h-4"}),label:"V-Line"},{type:"freehand",icon:(0,r.jsx)(A.A,{className:"w-4 h-4"}),label:"Draw"}];function z(e){let{activeTool:t,activeColor:n,onToolChange:o,onColorChange:l,onClearAll:i,drawingCount:s,compact:c=!1,minimal:u=!1}=e,[d,h]=(0,a.useState)(null),m=(0,a.useRef)(null),x=(0,a.useRef)(null);return u?(0,r.jsxs)("div",{className:"flex flex-col items-center py-2 px-1 gap-0.5",children:[R.map(e=>(0,r.jsx)("button",{onClick:()=>o("select"===e.type?null:e.type),title:e.label,className:"p-1.5 rounded transition-all ".concat(("select"!==e.type||t)&&t!==e.type?"text-white/50 hover:text-white hover:bg-white/10":"bg-[#FF6B4A] text-white"),children:e.icon},e.type)),(0,r.jsx)("div",{className:"w-5 h-px bg-white/10 my-1"}),(0,r.jsx)("button",{onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},title:"Color",className:"p-1.5 rounded hover:bg-white/10 transition-colors",children:(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border border-white/20",style:{backgroundColor:n}})}),(0,r.jsx)("input",{ref:m,type:"color",value:n,onChange:e=>l(e.target.value),className:"absolute opacity-0 w-0 h-0 pointer-events-none"}),s>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-5 h-px bg-white/10 my-1"}),(0,r.jsx)("button",{onClick:i,title:"Clear (".concat(s,")"),className:"p-1.5 rounded text-red-400/50 hover:text-red-400 hover:bg-red-400/10 transition-colors",children:(0,r.jsx)(P.A,{className:"w-4 h-4"})})]})]}):c?(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-white/5 backdrop-blur-md p-1 border border-white/10 shadow-xl overflow-x-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",children:[R.map(e=>(0,r.jsx)("button",{onClick:()=>o("select"===e.type?null:e.type),title:e.label,className:"p-1.5 rounded transition-all flex-shrink-0 ".concat(("select"!==e.type||t)&&t!==e.type?"text-white/60 hover:text-white hover:bg-white/10":"bg-[#FF6B4A] text-white"),children:e.icon},e.type)),(0,r.jsx)("div",{className:"w-px h-5 bg-white/10 mx-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},title:"Color",className:"p-1.5 rounded hover:bg-white/10 transition-colors flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border border-white/30",style:{backgroundColor:n}})}),(0,r.jsx)("input",{ref:x,type:"color",value:n,onChange:e=>l(e.target.value),className:"absolute opacity-0 w-0 h-0 pointer-events-none"})]}),s>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-px h-5 bg-white/10 mx-0.5 flex-shrink-0"}),(0,r.jsx)("button",{onClick:i,title:"Clear All (".concat(s,")"),className:"p-1.5 rounded text-red-400/60 hover:text-red-400 hover:bg-red-400/10 transition-colors flex-shrink-0",children:(0,r.jsx)(P.A,{className:"w-4 h-4"})})]})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-1 bg-white/5 backdrop-blur-md p-1.5 border border-white/10 shadow-xl z-20",children:[R.map(e=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>o("select"===e.type?null:e.type),onMouseEnter:()=>h(e.type),onMouseLeave:()=>h(null),className:"p-2 rounded transition-all ".concat(("select"!==e.type||t)&&t!==e.type?"text-white/60 hover:text-white hover:bg-white/10":"bg-[#FF6B4A] text-white"),children:e.icon}),d===e.type&&(0,r.jsx)("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 px-2 py-1 bg-black/90 rounded text-xs text-white whitespace-nowrap z-50 pointer-events-none",children:e.label})]},e.type)),(0,r.jsx)("div",{className:"h-px bg-white/10 my-1"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},onMouseEnter:()=>h("color"),onMouseLeave:()=>h(null),className:"p-2 rounded hover:bg-white/10 transition-colors flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-4 h-4 rounded-full border border-white/30",style:{backgroundColor:n}})}),(0,r.jsx)("input",{ref:m,type:"color",value:n,onChange:e=>l(e.target.value),className:"absolute opacity-0 w-0 h-0 pointer-events-none"}),"color"===d&&(0,r.jsx)("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 px-2 py-1 bg-black/90 rounded text-xs text-white whitespace-nowrap z-50 pointer-events-none",children:"Color"})]}),s>0&&(0,r.jsx)("div",{className:"h-px bg-white/10 my-1"}),s>0&&(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:i,onMouseEnter:()=>h("clear"),onMouseLeave:()=>h(null),className:"p-2 rounded text-red-400/60 hover:text-red-400 hover:bg-red-400/10 transition-colors",children:(0,r.jsx)(P.A,{className:"w-4 h-4"})}),"clear"===d&&(0,r.jsxs)("div",{className:"absolute left-full ml-2 top-1/2 -translate-y-1/2 px-2 py-1 bg-black/90 rounded text-xs text-white whitespace-nowrap z-50 pointer-events-none",children:["Clear All (",s,")"]})]})]})}var W=n(25703),B=n(19707);function V(e){let{isDark:t}=e,{scene:n}=(0,o.C)();return(0,a.useEffect)(()=>{n.background=new u.Color(t?"#0a0a0a":"#f9fafb")},[n,t]),null}function K(e){let{chartWidth:t,chartHeight:n}=e,l=(0,a.useRef)(null),{camera:i}=(0,o.C)();(0,a.useEffect)(()=>{let e,t=()=>{l.current&&l.current.lookAt(i.position)};t();let n=()=>{t(),e=requestAnimationFrame(n)};return n(),()=>{e&&cancelAnimationFrame(e)}},[i]);let s=(0,a.useMemo)(()=>{let e=document.createElement("canvas");e.width=512,e.height=128;let t=e.getContext("2d");if(!t)return null;t.clearRect(0,0,e.width,e.height),t.fillStyle="rgba(255, 255, 255, 0.12)",t.font="bold 64px Inter, system-ui, sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText("POLYX FREE",e.width/2,e.height/2);let n=new u.CanvasTexture(e);return n.needsUpdate=!0,n},[]);return s?(0,r.jsxs)("group",{ref:l,position:[t/2,n/2,5],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[20,5]}),(0,r.jsx)("meshBasicMaterial",{map:s,transparent:!0,opacity:.15,depthWrite:!1})]}),(0,r.jsxs)("mesh",{position:[-8,-2,-2],rotation:[0,0,Math.PI/12],children:[(0,r.jsx)("planeGeometry",{args:[16,4]}),(0,r.jsx)("meshBasicMaterial",{map:s,transparent:!0,opacity:.08,depthWrite:!1})]}),(0,r.jsxs)("mesh",{position:[8,2,-3],rotation:[0,0,-Math.PI/15],children:[(0,r.jsx)("planeGeometry",{args:[16,4]}),(0,r.jsx)("meshBasicMaterial",{map:s,transparent:!0,opacity:.08,depthWrite:!1})]})]}):null}function X(e){let{data:t,isLoading:n,showMarketCap:o,marketCap:m,price:p,onLoadMore:w,hasMoreData:v=!0,isLoadingMore:b=!1,showDrawingTools:y=!0,renderToolbar:j,showWatermark:k=!1,theme:M}=e,{isDark:C}=(0,B.C)(),N=M?"dark"===M:C;console.log("[Chart3D] Render - data.length:",t.length,"isLoading:",n);let F=(0,a.useRef)(null),S=(0,a.useRef)(null),L=(0,a.useRef)(null),D=(0,a.useRef)([]),A=(0,a.useMemo)(()=>t.length>0?(D.current=t,t):D.current.length>0?(console.log("[Chart3D] Using cached data, parent sent empty array"),D.current):t,[t]),[P,R]=(0,a.useState)(0),[X,Y]=(0,a.useState)(1),[G,$]=(0,a.useState)(!1),T=(0,a.useRef)(P),U=(0,a.useRef)(X),I=(0,a.useRef)(null),q=(0,a.useRef)(0),O=(0,a.useRef)(0),Q=(0,a.useRef)(!1),H=(0,a.useRef)(0),Z=(0,a.useRef)({start:0,end:0}),[_,J]=(0,a.useState)(!1),ee=(0,a.useRef)(!1),[et,en]=(0,a.useState)(1),er=(0,a.useRef)(1),[ea,eo]=(0,a.useState)(null),[el,ei]=(0,a.useState)(!1),[es,ec]=(0,a.useState)(!1),[eu,ed]=(0,a.useState)(0),eh=(0,a.useRef)(!1),[em,ex]=(0,a.useState)([]),[ep,ef]=(0,a.useState)(null),[eg,ew]=(0,a.useState)("#ef4444"),[ev,eb]=(0,a.useState)(2),ey=(0,a.useRef)(null);(0,a.useEffect)(()=>($(!0),()=>$(!1)),[]);let ej=(0,a.useCallback)(()=>{console.warn("[Chart3D] WebGL context lost - will attempt recovery"),eh.current=!0},[]),ek=(0,a.useCallback)(()=>{console.log("[Chart3D] WebGL context restored"),eh.current=!1},[]);(0,a.useEffect)(()=>{if(eh.current){let e=setTimeout(()=>{console.log("[Chart3D] Attempting WebGL recovery by remounting Canvas"),ed(e=>e+1),eh.current=!1},1e3);return()=>clearTimeout(e)}},[eu]);let eM=(0,a.useRef)(0);(0,a.useEffect)(()=>{let e=eM.current,t=A.length;console.log("[Chart3D] Data length changed:",{prevLength:e,newLength:t}),console.log("[Chart3D] Setting view to fully zoomed out: 0 to 1"),R(0),Y(1),eM.current=t},[A.length]),(0,a.useEffect)(()=>{P<=.01&&v&&!b&&w&&w()},[P,v,b,w]);let eC=(0,a.useMemo)(()=>{if(0===A.length)return[];let e=A.length,t=Math.max(0,Math.floor(P*e)),n=Math.min(e-1,Math.ceil(X*e));if(t>n)return A.slice(-1);let r=A.slice(t,n+1);if(r.length>200){let e=Math.ceil(r.length/200),t=[];for(let n=0;n<r.length;n+=e){let a=r.slice(n,Math.min(n+e,r.length));if(0===a.length)continue;let o={timestamp:a[0].timestamp,open:a[0].open,high:Math.max(...a.map(e=>e.high)),low:Math.min(...a.map(e=>e.low)),close:a[a.length-1].close,volume:a.reduce((e,t)=>e+t.volume,0)};t.push(o)}return console.log("[Chart3D] Aggregated from",r.length,"to",t.length,"candles (group size:",e,")"),t}return r},[A,P,X]),eE=60/(eC.length||1),eN=Math.min(.9,Math.max(.15,.75*eE)),eF=Math.min(.9,Math.max(.15,.8*eE)),eS=(0,a.useMemo)(()=>{if(0===eC.length)return{minPrice:0,maxPrice:1,maxVolume:1,priceRange:1};let e=1/0,t=-1/0,n=0;for(let r of eC){let a=Math.min(r.open,r.close,r.low),o=Math.max(r.open,r.close,r.high);isFinite(a)&&a>0&&(e=Math.min(e,a)),isFinite(o)&&o>0&&(t=Math.max(t,o)),isFinite(r.volume)&&(n=Math.max(n,r.volume))}if(p&&isFinite(p)&&p>0&&(e=Math.min(e,p),t=Math.max(t,p)),!isFinite(e)||!isFinite(t)||e<=0||t<=0)return{minPrice:0,maxPrice:1,maxVolume:n||1,priceRange:1};let r=t-e,a=(t+e)/2;if(0===r||r/a<1e-4){let n=.005*a;e=a-n,r=(t=a+n)-e}else{let n=.1*r;e-=n,t+=n,r=t-e}return{minPrice:e,maxPrice:t,maxVolume:n||1,priceRange:r}},[eC,p]),eL=(0,a.useMemo)(()=>[30,8,45],[]),eD=(0,a.useMemo)(()=>[30,5,0],[]),eA=e=>isFinite(e)&&0!==eS.priceRange?Math.max(0,Math.min(10,(e-eS.minPrice)/eS.priceRange*10)):5,eP=(0,a.useMemo)(()=>{if(0===eC.length)return"";let e=new Date(eC[0].timestamp),t=new Date(eC[eC.length-1].timestamp),n=e=>e.toLocaleDateString("en-US",{month:"short",day:"numeric"});return"".concat(n(e)," - ").concat(n(t))},[eC]),eR=(0,a.useMemo)(()=>{if(eC.length<2)return{value:0,percent:0,isPositive:!0};let e=eC[0].open,t=eC[eC.length-1].close-e;return{value:t,percent:e>0?t/e*100:0,isPositive:t>=0}},[eC]),ez=(0,a.useCallback)(e=>{var t;if(e.shiftKey||"CANVAS"===e.target.tagName)return;e.preventDefault();let n=Date.now();if(n-O.current<50)return;O.current=n;let r=e.deltaY<0,a=null==(t=F.current)?void 0:t.getBoundingClientRect();if(!a)return;let o=(e.clientX-a.left)/a.width,l=U.current-T.current,i=Math.max(.05,Math.min(1,l*(r?.9:1.1)))-l,s=T.current-i*o,c=U.current+i*(1-o);s<0&&(c-=s,s=0),c>1&&(s-=c-1,c=1),R(Math.max(0,s)),Y(Math.min(1,c))},[]),eW=(0,a.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),I.current=t,q.current=e.clientX},[]);(0,a.useEffect)(()=>{T.current=P,U.current=X},[P,X]),(0,a.useEffect)(()=>{let e=L.current;if(e)return e.addEventListener("wheel",ez,{passive:!1}),()=>{e.removeEventListener("wheel",ez)}},[ez]),(0,a.useEffect)(()=>{let e=e=>{if(!I.current||!S.current)return;let t=Date.now();if(t-O.current<33)return;O.current=t;let n=S.current.getBoundingClientRect(),r=(e.clientX-q.current)/n.width;q.current=e.clientX;let a=T.current,o=U.current,l=a,i=o;if("left"===I.current)R(l=Math.max(0,Math.min(o-.05,a+r)));else if("right"===I.current)Y(i=Math.max(a+.05,Math.min(1,o+r)));else if("middle"===I.current){let e=o-a;l=a+r,i=o+r,l<0&&(l=0,i=e),i>1&&(i=1,l=1-e),R(l),Y(i)}t%500<50&&console.log("[Chart3D] Slider drag:",{handle:I.current,newStart:l.toFixed(4),newEnd:i.toFixed(4),range:(i-l).toFixed(4)})},t=()=>{I.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[]);let eB=(0,a.useCallback)(()=>{R(0),Y(1),en(1),er.current=1},[]);(0,a.useEffect)(()=>{let e=e=>{"Shift"===e.key&&(ee.current=!0,J(!0))},t=e=>{"Shift"===e.key&&(ee.current=!1,J(!1),Q.current=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),(0,a.useEffect)(()=>{if(!G)return;let e=e=>{if(!e.shiftKey||2!==e.button)return;let t=L.current;if(!t)return;let n=t.getBoundingClientRect();if(e.clientX<n.left||e.clientX>n.right||e.clientY<n.top||e.clientY>n.bottom)return;let r=T.current,a=U.current;a-r>.9&&(a=1,R(r=.5),Y(a),T.current=r,U.current=a),e.preventDefault(),Q.current=!0,H.current=e.clientX,Z.current={start:r,end:a}},t=e=>{if(!Q.current)return;let t=L.current;if(!t)return;let n=Date.now();if(n-O.current<33)return;O.current=n;let r=t.getBoundingClientRect(),a=-((e.clientX-H.current)/r.width)*(Z.current.end-Z.current.start),o=Z.current.start+a,l=Z.current.end+a;o<0&&(l-=o,o=0),l>1&&(o-=l-1,l=1),R(Math.max(0,o)),Y(Math.min(1,l))},n=e=>{2===e.button&&Q.current&&(Q.current=!1)},r=e=>{if(e.shiftKey)return e.preventDefault(),!1};return window.addEventListener("mousedown",e),window.addEventListener("mousemove",t),window.addEventListener("mouseup",n),window.addEventListener("contextmenu",r),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n),window.removeEventListener("contextmenu",r)}},[G]),(0,a.useEffect)(()=>{let e=L.current;if(!e)return;let t=e=>{if(e.shiftKey){e.preventDefault();let t=e.deltaY<0,n=Math.max(.5,Math.min(3,er.current*(t?1.1:.9)));er.current=n,en(n)}};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[G]),(0,a.useEffect)(()=>{er.current=et},[et]),(0,a.useEffect)(()=>{let e=e=>{e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),ei(e=>{let t=!e;return t&&ec(!0),t}),console.log("[Chart3D] Fly mode toggled:",!el))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[el]),(0,a.useEffect)(()=>{if(es){let e=setTimeout(()=>{ec(!1)},4e3);return()=>clearTimeout(e)}},[es]);let eV=(0,a.useCallback)(()=>{ei(!1),console.log("[Chart3D] Exited fly mode")},[]);null!=p||eC.length>0&&eC[eC.length-1].close;let eK=(0,a.useCallback)(e=>{ex(t=>[...t,e]),console.log("[Chart3D] Drawing completed:",e.type,e.id)},[]),eX=(0,a.useCallback)(()=>{ex([]),console.log("[Chart3D] All drawings cleared")},[]);return(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&ep&&(e.preventDefault(),ef(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ep]),(0,r.jsxs)("div",{ref:F,className:"relative h-full w-full select-none flex ".concat("flex-row"," ").concat(j?"":N?"bg-[#0a0a0a]":"bg-gray-50"),onDoubleClick:eB,children:[!j&&(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px]",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-conic from-[#FF6B4A]/30 via-[#FF8F6B]/15 via-[#FF6B4A]/20 to-[#FF6B4A]/30 blur-[80px] animate-slow-spin ".concat(N?"":"opacity-50")})}),(0,r.jsx)("div",{className:"absolute inset-0 ".concat(N?"bg-[#0a0a0a]/60":"bg-white/60")})]}),n&&(0,r.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center ".concat(N?"bg-[#0a0a0a]/80":"bg-white/80"),children:(0,r.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[#FF6B4A] border-t-transparent"})}),y&&!el&&!j&&(0,r.jsx)("div",{className:"flex-shrink-0 p-2 z-20",children:(0,r.jsx)(z,{activeTool:ep,activeColor:eg,activeLineWidth:ev,onToolChange:ef,onColorChange:ew,onLineWidthChange:eb,onClearAll:eX,drawingCount:em.length})}),j&&(0,r.jsx)("div",{className:"flex-shrink-0 z-20 h-full overflow-hidden",children:j({activeTool:ep,activeColor:eg,activeLineWidth:ev,onToolChange:ef,onColorChange:ew,onLineWidthChange:eb,onClearAll:eX,drawingCount:em.length})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 relative",children:[!j&&y&&(0,r.jsxs)("div",{className:"absolute top-4 left-4 z-10",children:[o&&m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xs mb-0.5 ".concat(N?"text-white/50":"text-gray-500"),children:"Market Cap"}),(0,r.jsxs)("div",{className:"text-2xl font-bold ".concat(N?"text-white":"text-gray-900"),children:["$",(0,W.ZV)(m)]})]}):p?(0,r.jsxs)("div",{className:"text-2xl font-bold ".concat(N?"text-white":"text-gray-900"),children:["$",(0,W.$g)(p)]}):(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(N?"text-white/50":"text-gray-400"),children:"Loading..."}),(0,r.jsxs)("div",{className:"text-xs ".concat(N?"text-white/50":"text-gray-500"),children:[eP," â€¢ ",eC.length," candles"]})]}),!j&&y&&!el&&(0,r.jsxs)("div",{className:"absolute top-4 z-10 text-right",style:{right:"200px"},children:[(0,r.jsxs)("div",{className:"text-sm font-medium ".concat(eR.isPositive?"text-up":"text-down"),children:[eR.isPositive?"+":"","$",(0,W.$g)(eR.value)," (",eR.isPositive?"+":"",eR.percent.toFixed(2),"%)"]}),(0,r.jsx)("div",{className:"text-xs ".concat(N?"text-white/50":"text-gray-500"),children:"visible range"})]}),(0,r.jsxs)("div",{ref:L,className:"flex-1 relative",children:[G&&(0,r.jsxs)(l.Hl,{className:"rounded-xl",gl:{antialias:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1},onCreated:e=>{let{gl:t,scene:n}=e;console.log("[Chart3D] Canvas created (key:",eu,")"),n.background=new u.Color(N?"#0a0a0a":"#f9fafb"),t.domElement.addEventListener("webglcontextlost",e=>{console.error("[Chart3D] WebGL context lost!",e),e.preventDefault(),ej()}),t.domElement.addEventListener("webglcontextrestored",()=>{console.log("[Chart3D] WebGL context restored"),ek()})},children:[(0,r.jsx)(V,{isDark:N}),(0,r.jsxs)(a.Suspense,{fallback:null,children:[(0,r.jsx)(i.u,{makeDefault:!0,position:eL,fov:50}),(0,r.jsx)("ambientLight",{intensity:.5}),(0,r.jsx)("directionalLight",{position:[10,20,10],intensity:1}),(0,r.jsx)("pointLight",{position:[-10,10,-10],intensity:.4}),eC.length>0&&(0,r.jsxs)("group",{scale:[1,et,1],position:[0,5*(1-et),0],children:[(0,r.jsx)(x,{width:60,height:10,depth:8,isDark:N}),(0,r.jsx)(f,{minPrice:eS.minPrice,maxPrice:eS.maxPrice,candleCount:eC.length,chartWidth:60,chartHeight:10,showMarketCap:o,data:eC,spacing:eE,isDark:N}),eC.map((e,t)=>(0,r.jsx)(d,{index:t,open:eA(e.open),high:eA(e.high),low:eA(e.low),close:eA(e.close),isUp:e.close>=e.open,isLatest:t===eC.length-1,spacing:eE,width:eN,depth:eF},"".concat(e.timestamp,"-").concat(t))),eC.map((e,t)=>{var n;return(0,r.jsx)(h,{index:t,height:(n=e.volume,0===eS.maxVolume?0:n/eS.maxVolume*3),isUp:e.close>=e.open,spacing:eE,width:eN,depth:eF,zOffset:4},"vol-".concat(e.timestamp,"-").concat(t))}),k&&(0,r.jsx)(K,{chartWidth:60,chartHeight:10})]}),(0,r.jsx)(s.N,{ref:ey,enabled:!el&&!ep&&!_,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:15,maxDistance:100,minPolarAngle:.2,maxPolarAngle:Math.PI/2.2,target:eD}),(0,r.jsx)(E,{drawings:em,activeTool:ep,activeColor:eg,activeLineWidth:ev,onDrawingComplete:eK,enabled:!el,orbitControlsRef:ey}),(0,r.jsx)(g.o,{enabled:el,movementSpeed:20,lookSpeed:.002,onExit:eV}),(0,r.jsx)(c.OH,{preset:"night"})]})]},eu),G&&0===eC.length&&!n&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center ".concat(N?"text-white/50 bg-[#0a0a0a]/80":"text-gray-500 bg-white/80"),children:"No chart data available"})]}),!j&&y&&(0,r.jsxs)("div",{ref:S,className:"h-10 mx-4 mb-2 relative border ".concat(N?"bg-white/5 border-white/10":"bg-black/5 border-black/10"),children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-30",children:A.length>1&&eS.priceRange>0&&(0,r.jsx)("svg",{viewBox:"0 0 ".concat(A.length," 100"),preserveAspectRatio:"none",className:"w-full h-full",children:(0,r.jsx)("path",{d:A.map((e,t)=>{let n=Math.max(0,Math.min(100,100-(e.close-eS.minPrice)/eS.priceRange*100));return"".concat(0===t?"M":"L"," ").concat(t," ").concat(isFinite(n)?n:50)}).join(" "),fill:"none",stroke:eR.isPositive?"#10b981":"#ef4444",strokeWidth:"2",vectorEffect:"non-scaling-stroke"})})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 left-0 ".concat(N?"bg-[#0a0a0a]/70":"bg-white/70"),style:{width:"".concat(100*P,"%")}}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 right-0 ".concat(N?"bg-[#0a0a0a]/70":"bg-white/70"),style:{width:"".concat((1-X)*100,"%")}}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 cursor-ew-resize flex items-center z-10",style:{left:"".concat(100*P,"%")},onMouseDown:e=>eW(e,"left"),children:(0,r.jsx)("div",{className:"w-2 h-6 bg-[#FF6B4A] -ml-1"})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 cursor-ew-resize flex items-center z-10",style:{left:"".concat(100*X,"%")},onMouseDown:e=>eW(e,"right"),children:(0,r.jsx)("div",{className:"w-2 h-6 bg-[#FF6B4A] -ml-1"})}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 cursor-grab active:cursor-grabbing border-t-2 border-b-2 border-[#FF6B4A]/50",style:{left:"".concat(100*P,"%"),width:"".concat((X-P)*100,"%")},onMouseDown:e=>eW(e,"middle")})]})]}),b&&(0,r.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex items-center gap-2 backdrop-blur-md border px-3 py-1.5 ".concat(N?"bg-white/5 border-white/10":"bg-black/5 border-black/10"),children:[(0,r.jsx)("div",{className:"h-3 w-3 animate-spin rounded-full border border-[#FF6B4A] border-t-transparent"}),(0,r.jsx)("span",{className:"text-xs ".concat(N?"text-white/50":"text-gray-500"),children:"Loading more..."})]}),y&&!el&&!j&&(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsxs)("div",{className:"bg-[#FF6B4A]/10 border border-[#FF6B4A]/30 px-3 py-1.5 text-xs",children:[(0,r.jsx)("span",{className:"text-[#FF6B4A] font-medium",children:"Shift+Enter"}),(0,r.jsx)("span",{className:N?"text-white/50":"text-gray-500",children:" for fly mode"})]})}),el&&es&&(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none animate-in fade-in duration-300",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 backdrop-blur-md px-6 py-4 border border-[#FF6B4A]/50 ".concat(N?"bg-[#0a0a0a]/90":"bg-white/90"),children:[(0,r.jsx)("div",{className:"text-[#FF6B4A] font-bold text-lg",children:"FLY MODE"}),(0,r.jsxs)("div",{className:"text-xs text-center space-y-1 ".concat(N?"text-white/50":"text-gray-500"),children:[(0,r.jsx)("p",{children:"Click to lock mouse - ESC to exit"}),(0,r.jsx)("p",{className:"font-mono",children:"W/S: Forward/Back - A/D: Strafe"}),(0,r.jsx)("p",{className:"font-mono",children:"Q/E: Down/Up - Shift: Speed boost"})]})]})}),el&&!es&&(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsxs)("div",{className:"bg-[#FF6B4A]/20 border border-[#FF6B4A] px-3 py-1.5 text-xs",children:[(0,r.jsx)("span",{className:"text-[#FF6B4A] font-bold",children:"FLY MODE"}),(0,r.jsx)("span",{className:N?"text-white/50":"text-gray-500",children:" - ESC to exit"})]})}),y&&!j&&(0,r.jsx)("div",{className:"absolute bottom-14 left-4 backdrop-blur-md border px-3 py-1.5 text-xs ".concat(N?"bg-white/5 border-white/10 text-white/50":"bg-black/5 border-black/10 text-gray-500"),children:el?"WASD: move - Q/E: up/down - Mouse: look - Shift: speed - ESC: exit":"Drag: rotate - Scroll: zoom - Shift+Scroll: scale Y - Shift+Right-drag: pan history - Double-click: reset"})]})}}}]);